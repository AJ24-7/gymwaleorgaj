<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym-Wale Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="admin-support.css">
    <link rel="stylesheet" href="enhanced-communication-styles.css">
    <link rel="stylesheet" href="admin-notification-styles.css">
    
    <!-- Immediate layout positioning script -->
    <script>
        // Apply critical positioning immediately to prevent layout shift
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[CRITICAL] Applying immediate positioning...');
            
            const sidebar = document.querySelector('.sidebar');
            const navbar = document.querySelector('.top-navbar');
            const mainContent = document.querySelector('.main-content');
            
            if (sidebar) {
                sidebar.style.setProperty('position', 'fixed', 'important');
                sidebar.style.setProperty('left', '0', 'important');
                sidebar.style.setProperty('top', '0', 'important');
                sidebar.style.setProperty('width', '280px', 'important');
                sidebar.style.setProperty('height', '100vh', 'important');
                sidebar.style.setProperty('z-index', '1100', 'important');
            }
            
            if (navbar) {
                navbar.style.setProperty('position', 'fixed', 'important');
                navbar.style.setProperty('left', '280px', 'important');
                navbar.style.setProperty('top', '0', 'important');
                navbar.style.setProperty('right', '0', 'important');
                navbar.style.setProperty('height', '75px', 'important');
                navbar.style.setProperty('z-index', '1050', 'important');
                navbar.style.setProperty('background', 'linear-gradient(90deg, #1e293b 0%, #334155 100%)', 'important');
                navbar.style.setProperty('color', 'white', 'important');
                navbar.style.setProperty('display', 'flex', 'important');
                navbar.style.setProperty('align-items', 'center', 'important');
                navbar.style.setProperty('justify-content', 'space-between', 'important');
                navbar.style.setProperty('padding', '0 32px', 'important');
                navbar.style.setProperty('border-bottom', '1px solid rgba(255, 255, 255, 0.1)', 'important');
                navbar.style.setProperty('border-left', '1px solid rgba(255, 255, 255, 0.1)', 'important');
                navbar.style.setProperty('box-shadow', '0 4px 20px rgba(0, 0, 0, 0.15)', 'important');
            }
            
            if (mainContent) {
                mainContent.style.setProperty('margin-left', '280px', 'important');
                mainContent.style.setProperty('padding-top', '75px', 'important');
                mainContent.style.setProperty('min-height', '100vh', 'important');
                mainContent.style.setProperty('background', '#f8fafc', 'important');
            }
            
            // Force a reflow
            if (navbar) navbar.offsetHeight;
            if (mainContent) mainContent.offsetHeight;
            
            console.log('[CRITICAL] Immediate positioning applied successfully');
        });
    </script>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="admin-auth-guard.js"></script>
    <script defer src="admin.js"></script>
    <script defer src="admin-profile.js"></script>
    <script defer src="admin-notification-system.js"></script>
    <script defer src="unified-communication-system.js"></script>
    <script defer src="whatsapp-integration.js"></script>
    <script defer src="subscription-management.js"></script>
   
</head>
<body>
    <!-- Hamburger for mobile -->
    <div class="hamburger" id="hamburgerMenu" aria-label="Open sidebar" tabindex="0">
        <span></span>
        <span></span>
        <span></span>
    </div>
    
    <!-- Mobile overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <div class="sidebar" id="sidebarMenu">
        <div class="sidebar-header">
            <img src="public/Gym-Wale.png" alt="Gym-Wale Logo">
            <h3>Gym-Wale</h3>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li><a href="#" class="active" id="dashboard-tab">
                    <i class="fas fa-tachometer-alt"></i> 
                    <span>Dashboard</span>
                </a></li>
                <li><a href="#" id="gym-tab">
                    <i class="fas fa-dumbbell"></i> 
                    <span>Gym Management</span>
                </a></li>
                <li><a href="#" id="subscription-tab">
                    <i class="fas fa-credit-card"></i> 
                    <span>Subscription Management</span>
                </a></li>
                <li><a href="#" id="trainer-management-tab">
                    <i class="fas fa-users-cog"></i> 
                    <span>Trainer Management</span>
                </a></li>
                <li><a href="#" id="payment-tab">
                    <i class="fas fa-money-bill-wave"></i> 
                    <span>Payments</span>
                </a></li>
                <li><a href="#" id="support-tab">
                    <i class="fas fa-headset"></i> 
                    <span>Support</span>
                </a></li>
                <li><a href="#" id="profile-tab">
                    <i class="fas fa-user-circle"></i> 
                    <span>My Profile</span>
                </a></li>
                <li><a href="#" id="settings-tab">
                    <i class="fas fa-cog"></i> 
                    <span>Settings</span>
                </a></li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Navbar -->
        <!-- Enhanced Top Navbar -->
        <div class="top-navbar">
            <div class="navbar-left">
                <div class="breadcrumb">
                    <span id="currentPageTitle">Dashboard</span>
                </div>
            </div>
            
            <div class="user-info">
                <div class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-count" id="notificationCount" style="display: none;">0</span>
            
                    <!-- Enhanced Notification Dropdown -->
                    <div class="notification-dropdown" id="notificationDropdown" style="display: none;">
                        <div class="notification-header">
                            <h4>Notifications</h4>
                            <a href="#" onclick="markAllAsRead(); return false;">Mark All Read</a>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <div class="no-notifications">
                                <i class="fas fa-bell-slash"></i>
                                <p>No new notifications</p>
                            </div>
                        </div>
                        <div class="notification-footer">
                            <a href="#" onclick="viewAllNotifications(); return false;">View All Notifications</a>
                        </div>
                    </div>
                </div>
                
                <div class="admin-dropdown" onclick="toggleAdminMenu()">
                    <img id="navbarAdminAvatar" src="/assets/admin-avatar.png" alt="Admin" 
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMzNzQxNTEiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDEyQzE0LjIwOTEgMTIgMTYgMTAuMjA5MSAxNiA4QzE2IDUuNzkwODYgMTQuMjA5MSA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaTTEyIDEyVjEyWiIgZmlsbD0iI0Y5RkFGQiIvPgo8cGF0aCBkPSJNMTIgMTRDOC4xMzQwMSAxNCA1IDE3LjEzNCA1IDIxSDE5QzE5IDE3LjEzNCAxNS44NjYgMTQgMTIgMTRaIiBmaWxsPSIjRjlGQUZCIi8+Cjwvc3ZnPgo8L3N2Zz4K'">
                    <span id="navbarAdminName">Admin User</span>
                    <i class="fas fa-chevron-down" style="font-size: 12px; margin-left: 4px;"></i>
                    
                    <div class="admin-menu" id="adminMenu" style="display: none;">
                        <a href="#" onclick="showTab('profile-content'); return false;">
                            <i class="fas fa-user"></i> Profile
                        </a>
                        <a href="#" onclick="showTab('settings-content'); return false;">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <a href="#" onclick="adminLogout(); return false;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
  
        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Content -->
            <div id="dashboard-content" class="tab-content active">
                <div class="page-header">
                    <h2>Dashboard Overview</h2>
                    <div class="dashboard-controls">
                        <select class="dashboard-filter" id="dashboard-time-filter">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month" selected>This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                        </select>
                        <button class="btn btn-secondary" id="refresh-dashboard">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-primary" id="export-report">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                </div>
                
                <!-- Key Metrics Cards -->
                <div class="dashboard-cards">
                    <div class="card metric-card">
                        <div class="card-header">
                            <h3>Total Revenue</h3>
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="card-body">
                            <h2 data-detail="revenue">₹0</h2>
                            <div class="metric-details">
                                <span class="metric-change" data-change="revenue">
                                    <i class="fas fa-arrow-up"></i> 0% from last period
                                </span>
                                <div class="metric-breakdown">
                                    <span data-detail="subscription">Subscription: <strong>₹0</strong></span>
                                    <span>One-time: <strong>₹0</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card metric-card success">
                        <div class="card-header">
                            <h3>Active Users</h3>
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-body">
                            <h2 data-metric="active-users">0</h2>
                            <div class="metric-details">
                                <span class="metric-change" data-change="users">
                                    <i class="fas fa-arrow-up"></i> 0% from last period
                                </span>
                                <div class="metric-breakdown">
                                    <span>New: <strong data-detail="new-users">0</strong></span>
                                    <span>Returning: <strong data-detail="returning-users">0</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card metric-card info">
                        <div class="card-header">
                            <h3>Active Gyms</h3>
                            <i class="fas fa-dumbbell"></i>
                        </div>
                        <div class="card-body">
                            <h2 data-metric="active-gyms">0</h2>
                            <div class="metric-details">
                                <span class="metric-change" data-change="gyms">
                                    <i class="fas fa-arrow-up"></i> 0% from last period
                                </span>
                                <div class="metric-breakdown">
                                    <span>Pending: <strong data-detail="pending-gyms">0</strong></span>
                                    <span>Premium: <strong data-detail="premium-gyms">0</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card metric-card warning">
                        <div class="card-header">
                            <h3>System Health</h3>
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="card-body">
                            <h2 data-metric="system-health">98%</h2>
                            <div class="metric-details">
                                <span class="metric-change">
                                    <i class="fas fa-check-circle"></i> All systems operational
                                </span>
                                <div class="metric-breakdown">
                                    <span>Uptime: <strong data-detail="uptime">99.9%</strong></span>
                                    <span>Response: <strong data-detail="response"><200ms</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions-section">
                    <h3>Quick Actions</h3>
                    <div class="quick-actions-grid">
                        <button class="quick-action-btn" onclick="showTab('gym-content')">
                            <i class="fas fa-plus"></i>
                            <span>Add New Gym</span>
                        </button>
                        <button class="quick-action-btn" onclick="showTab('trainer-management-content')">
                            <i class="fas fa-user-plus"></i>
                            <span>Approve Trainers</span>
                        </button>
                        <button class="quick-action-btn" onclick="showTab('subscription-content')">
                            <i class="fas fa-credit-card"></i>
                            <span>Manage Subscriptions</span>
                        </button>
                        <button class="quick-action-btn" onclick="showTab('support-content')">
                            <i class="fas fa-headset"></i>
                            <span>Support Tickets</span>
                        </button>
                    </div>
                </div>
                
                <!-- Enhanced Analytics Charts -->
                <div class="dashboard-charts">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Revenue Trends</h3>
                            <div class="chart-controls">
                                <button class="chart-period-btn active" data-period="7">7D</button>
                                <button class="chart-period-btn" data-period="30">30D</button>
                                <button class="chart-period-btn" data-period="90">90D</button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="revenueChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>User Distribution</h3>
                            <div class="chart-controls">
                                <button class="chart-period-btn active" data-period="7">7D</button>
                                <button class="chart-period-btn" data-period="30">30D</button>
                                <button class="chart-period-btn" data-period="90">90D</button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="usersChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced Real-time Activity Feed -->
                <div class="dashboard-grid">
                    <div class="activity-feed-container">
                        <div class="activity-feed-header">
                            <h3>Recent Activities</h3>
                            <div class="activity-filters">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="gym">Gyms</button>
                                <button class="filter-btn" data-filter="trainer">Trainers</button>
                                <button class="filter-btn" data-filter="payment">Payments</button>
                                <button class="filter-btn" data-filter="trial">Trials</button>
                                <button class="filter-btn" data-filter="system">System</button>
                            </div>
                        </div>
                        <div id="activity-feed">
                            <!-- Dynamic activity items will be loaded here -->
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Dashboard Analytics</h3>
                            <div class="chart-controls">
                                <button class="chart-period-btn active" data-period="7">7D</button>
                                <button class="chart-period-btn" data-period="30">30D</button>
                                <button class="chart-period-btn" data-period="90">90D</button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="dashboardChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gym Management Content -->
            <div id="gym-content" class="tab-content">
                <div class="page-header">
                    <h2>Gym Management</h2>
                    <div style="display:flex;align-items:center;gap:16px;">
                         <span class="gym-count-label" style="font-size:1.1em;color:#1976d2;font-weight:600;">Total: <span id="count-all-gyms">(0)</span></span>
                        <button class="btn btn-primary" id="add-gym-btn"><i class="fas fa-plus"></i> Add Gym</button>
                    </div>
                </div>
            
                <div class="gym-tabs">
                    <div class="gym-tab active" data-tab="all-gyms">All Gyms <span id="count-all-gyms" class="gym-count-tab">(0)</span></div>
                    <div class="gym-tab" data-tab="pending-gyms">Pending Approval <span id="count-pending-gyms" class="gym-count-tab">(0)</span></div>
                    <div class="gym-tab" data-tab="approved-gyms">Approved <span id="count-approved-gyms" class="gym-count-tab">(0)</span></div>
                    <div class="gym-tab" data-tab="rejected-gyms">Rejected <span id="count-rejected-gyms" class="gym-count-tab">(0)</span></div>
                    <div class="gym-tab" data-tab="trial-bookings">Trial Bookings</div>
                </div>
            
                <!-- All Gyms -->
                <div class="gym-tab-content active" id="all-gyms">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Gym Name</th>
                                    <th>Owner</th>
                                    <th>Location</th>
                                    <th>Members</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-gyms-body">
                                <tr><td colspan="7">Loading gyms...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            
                <!-- Pending Gyms -->
                <div class="gym-tab-content" id="pending-gyms">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Gym Name</th>
                                    <th>Owner</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Submitted On</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pending-gyms-body">
                                <tr><td colspan="6">Loading pending gyms...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            
                <!-- Approved Gyms -->
                <div class="gym-tab-content" id="approved-gyms">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Gym Name</th>
                                    <th>Owner</th>
                                    <th>Location</th>
                                    <th>Members</th>
                                    <th>Status</th>
                                    <th>Approved On</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="approved-gyms-body">
                                <tr><td colspan="7">Loading approved gyms...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            
                <!-- Rejected Gyms -->
                <div class="gym-tab-content" id="rejected-gyms">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Gym Name</th>
                                    <th>Owner</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Reason</th>
                                    <th>Rejected On</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="rejected-gyms-body">
                                <tr><td colspan="7">Loading rejected gyms...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gym Detail Modal (hidden by default, shown via JS) -->
            <div id="gymDetailModal" class="gym-detail-modal" style="display:none;">
              <div class="gym-detail-modal-overlay"></div>
              <div class="gym-detail-modal-content">
                <!-- Dynamic gym info will be injected here by admin.js -->
                <button class="gym-detail-modal-close" id="closeGymDetailModal" aria-label="Close">&times;</button>
                <div id="gymDetailContent"></div>
              </div>
            </div>

            <!-- Subscription Management Content -->
            <div id="subscription-content" class="tab-content">
                <div class="page-header">
                    <h2>Subscription Management</h2>
                    <div style="display:flex;align-items:center;gap:16px;">
                        <button class="btn btn-primary" id="refresh-subscriptions"><i class="fas fa-sync-alt"></i> Refresh</button>
                        <button class="btn btn-success" id="export-subscriptions"><i class="fas fa-download"></i> Export</button>
                    </div>
                </div>

                <!-- Subscription Analytics Cards -->
                <div class="dashboard-cards" style="margin-bottom: 30px;">
                    <div class="card success">
                        <div class="card-header">
                            <h3>Active Subscriptions</h3>
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="card-body">
                            <h2 id="active-subscriptions-count">--</h2>
                            <p>Currently paying customers</p>
                        </div>
                    </div>
                    <div class="card warning">
                        <div class="card-header">
                            <h3>Trial Subscriptions</h3>
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="card-body">
                            <h2 id="trial-subscriptions-count">--</h2>
                            <p id="trial-ending-soon">-- ending soon</p>
                        </div>
                    </div>
                    <div class="card primary">
                        <div class="card-header">
                            <h3>Monthly Revenue</h3>
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="card-body">
                            <h2 id="monthly-revenue">--</h2>
                            <p>This month's earnings</p>
                        </div>
                    </div>
                    <div class="card danger">
                        <div class="card-header">
                            <h3>Expired/Cancelled</h3>
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="card-body">
                            <h2 id="expired-subscriptions-count">--</h2>
                            <p>Needs attention</p>
                        </div>
                    </div>
                </div>

                <!-- Subscription Filters -->
                <div class="filters-container" style="background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div class="filter-group">
                            <label>Status:</label>
                            <select id="subscription-status-filter" class="form-control" style="min-width: 150px;">
                                <option value="">All Status</option>
                                <option value="trial">Trial</option>
                                <option value="active">Active</option>
                                <option value="expired">Expired</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="pending_payment">Pending Payment</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Plan:</label>
                            <select id="subscription-plan-filter" class="form-control" style="min-width: 130px;">
                                <option value="">All Plans</option>
                                <option value="1month">Monthly</option>
                                <option value="3month">Quarterly</option>
                                <option value="6month">Half-Yearly</option>
                                <option value="12month">Annual</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Search:</label>
                            <input type="text" id="subscription-search" placeholder="Search gym name, email..." class="form-control" style="min-width: 200px;">
                        </div>
                        <button class="btn btn-primary" id="apply-subscription-filters"><i class="fas fa-filter"></i> Apply Filters</button>
                        <button class="btn btn-secondary" id="clear-subscription-filters"><i class="fas fa-times"></i> Clear</button>
                    </div>
                </div>

                <!-- Subscription Table -->
                <div class="table-container">
                    <table id="subscriptions-table">
                        <thead>
                            <tr>
                                <th>Gym Name</th>
                                <th>Plan</th>
                                <th>Status</th>
                                <th>Amount</th>
                                <th>Trial/Subscription Period</th>
                                <th>Payment Method</th>
                                <th>Last Payment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subscriptions-table-body">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #1976d2;"></i>
                                    <p style="margin: 10px 0 0 0; color: #666;">Loading subscriptions...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination-container" id="subscription-pagination" style="display: none;">
                    <div class="pagination-info">
                        <span id="subscription-pagination-info">Showing 0 of 0 subscriptions</span>
                    </div>
                    <div class="pagination-controls">
                        <button id="subscription-prev-page" class="btn btn-secondary" disabled>Previous</button>
                        <span id="subscription-page-numbers"></span>
                        <button id="subscription-next-page" class="btn btn-secondary" disabled>Next</button>
                    </div>
                </div>
            </div>

            <!-- Subscription Detail Modal -->
            <div id="subscriptionDetailModal" class="modal" style="display: none;">
                <div class="modal-overlay"></div>
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3 id="subscription-modal-title">Subscription Details</h3>
                        <button class="modal-close" id="closeSubscriptionModal">&times;</button>
                    </div>
                    <div class="modal-body" id="subscriptionModalContent">
                        <!-- Subscription details will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Subscription Actions Modal -->
            <div id="subscriptionActionModal" class="modal" style="display: none;">
                <div class="modal-overlay"></div>
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3 id="subscription-action-modal-title">Subscription Action</h3>
                        <button class="modal-close" id="closeSubscriptionActionModal">&times;</button>
                    </div>
                    <div class="modal-body" id="subscriptionActionModalContent">
                        <!-- Action form will be loaded here -->
                    </div>
                </div>
            </div>

                        <!-- Trainer Management Content (Tabbed like Gym Management) -->
                        <div id="trainer-management-content" class="tab-content">
                            <div class="page-header" style="margin-bottom:20px;">
                                <h2 style="display:flex;align-items:center;gap:10px;">
                                    <i class="fas fa-user-tie"></i> Trainer Management
                                </h2>
                                <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
                                    <!-- Removed trainer request & simulate buttons as per requirement -->
                                </div>
                            </div>

                            <!-- Trainer Tabs (Independent / Gym Based / Requests) -->
                            <div class="gym-tabs trainer-tabs" id="trainerTabs" style="margin-bottom:18px;">
                                <div class="gym-tab active" data-tab="independent-trainers">Independent Trainers <span id="count-independent-trainers" class="gym-count-tab">(0)</span></div>
                                <div class="gym-tab" data-tab="gym-based-trainers">Gym Based <span id="count-gym-based-trainers" class="gym-count-tab">(0)</span></div>
                                <div class="gym-tab" data-tab="trainer-requests">Requests <span id="count-trainer-requests" class="gym-count-tab">(0)</span></div>
                            </div>

                            <!-- Independent Trainers Tab Content -->
                            <div class="gym-tab-content active" id="independent-trainers">
                                <div class="table-container">
                                    <table id="independentTrainersTable">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Specialty</th>
                                                <th>Experience</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="independentTrainersBody">
                                            <tr><td colspan="6" style="text-align:center;color:#64748b;">No independent trainers yet</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Gym Based Trainers Tab Content -->
                            <div class="gym-tab-content" id="gym-based-trainers">
                                <div class="table-container">
                                    <table id="gymBasedTrainersTable">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Gym</th>
                                                <th>Specialty</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="gymBasedTrainersBody">
                                            <tr><td colspan="6" style="text-align:center;color:#64748b;">No gym based trainers yet</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Trainer Requests Tab Content -->
                            <div class="gym-tab-content" id="trainer-requests">
                                <div class="table-container">
                                    <table id="trainerRequestsTable">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Type</th>
                                                <th>Submitted</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="trainerRequestsBody">
                                            <tr><td colspan="6" style="text-align:center;color:#64748b;">No trainer requests</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

            <!-- Support Content -->
            <div id="support-content" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-headset"></i> Support & Communication</h2>
                    <div class="support-header-actions">
                        <button class="btn btn-primary" id="refreshSupportData" onclick="if(window.supportSystem) { window.supportSystem.forceRefresh(); }">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                    <div class="support-stats">
                        <div class="stat-item">
                            <span class="stat-label">Open Tickets:</span>
                            <span class="stat-value" id="openTicketsCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Resolved Today:</span>
                            <span class="stat-value" id="resolvedTodayCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Avg Response Time:</span>
                            <span class="stat-value" id="avgResponseTime">--</span>
                        </div>
                    </div>
                </div>

                <!-- Support Tickets Section -->
                    <div class="support-tabs">
                        <div class="support-tab active" data-tab="users">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                            <span class="support-count" id="userTicketsCount">(0)</span>
                        </div>
                        <div class="support-tab" data-tab="gym-admins">
                            <i class="fas fa-building"></i>
                            <span>Gym Admins</span>
                            <span class="support-count" id="gymAdminTicketsCount">(0)</span>
                        </div>
                        <div class="support-tab" data-tab="trainers">
                            <i class="fas fa-dumbbell"></i>
                            <span>Trainers</span>
                            <span class="support-count" id="trainerTicketsCount">(0)</span>
                        </div>
                    </div>

                    <!-- Support Filter Options -->
                    <div class="support-filters">
                        <div class="filter-group">
                            <label for="priorityFilter">Priority:</label>
                            <select id="priorityFilter" class="filter-select">
                                <option value="all">All Priorities</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="statusFilter">Status:</label>
                            <select id="statusFilter" class="filter-select">
                                <option value="all">All Status</option>
                                <option value="open">Open</option>
                                <option value="in-progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="categoryFilter">Category:</label>
                            <select id="categoryFilter" class="filter-select">
                                <option value="all">All Categories</option>
                                <option value="technical">Technical Issue</option>
                                <option value="billing">Billing & Payment</option>
                                <option value="membership">Membership</option>
                                <option value="equipment">Equipment</option>
                                <option value="general">General Inquiry</option>
                                <option value="complaint">Complaint</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <input type="text" id="searchTickets" class="search-input" placeholder="Search tickets...">
                        </div>
                    </div>

                <!-- Support Tab Contents -->
                <div class="support-tab-contents">
                    <!-- Users Support Tab -->
                    <div class="support-tab-content active" id="users-support">
                        <div class="support-tickets-container">
                            <div class="support-tickets-list" id="userTicketsList">
                                <!-- Dynamic content will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Gym Admins Support Tab -->
                    <div class="support-tab-content" id="gym-admins-support">
                        <div class="support-tickets-container">
                            <div class="support-tickets-list" id="gymAdminTicketsList">
                                <!-- Dynamic content will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Trainers Support Tab -->
                    <div class="support-tab-content" id="trainers-support">
                        <div class="support-tickets-container">
                            <div class="support-tickets-list" id="trainerTicketsList">
                                <!-- Dynamic content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Profile Content -->
            <div id="profile-content" class="tab-content">
                <div class="page-header">
                    <h2><i class="fas fa-user-circle"></i> My Profile</h2>
                    <div class="profile-header-actions">
                        <button class="btn btn-primary" id="editProfileBtn">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                </div>

                <div class="profile-container">
                    <!-- Left Column -->
                    <div class="profile-left-column">
                        <!-- Enhanced Profile Overview -->
                        <div class="profile-card">
                            <div class="profile-header">
                                <div class="profile-avatar">
                                    <img id="profileAvatar" src="/assets/admin-avatar.png" alt="Admin Avatar" 
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDgiIGN5PSI0OCIgcj0iNDgiIGZpbGw9IiMzNzQxNTEiLz4KPHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI4IDI4QzMzLjUyMjggMjggNDAgMjQuNDE4MyA0MCAyMFY4QzQwIDMuNTgxNzMgMzMuNTIyOCAwIDI4IDBDMjAuNDc3MiAwIDE2IDMuNTgxNzMgMTYgOFYyMEMxNiAyNC40MTgzIDIyLjQ3NzIgMjggMjggMjhaIiBmaWxsPSIjRjlGQUZCIi8+CjxwYXRoIGQ9Ik0yOCAzMkMxNi41MzYgMzIgOCA0MC41MzYgOCA1MkM4IDUyIDIyLjUzNiA1NiAyOCA1NkMzMy40NjQgNTYgNDggNTIgNDggNTJDNDggNDAuNTM2IDM5LjQ2NCAzMiAyOCAzMloiIGZpbGw9IiNGOUZBRkIiLz4KPC9zdmc+Cjwvc3ZnPgo='">
                                    <button class="avatar-upload-btn" onclick="document.getElementById('avatarInput').click()" title="Change Avatar">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                </div>
                                <div class="profile-info">
                                    <h3 id="profileName">Loading...</h3>
                                    <p id="profileEmail">Loading...</p>
                                    <div class="profile-badges">
                                        <span class="badge badge-primary" id="profileRole">Super Admin</span>
                                        <span class="badge badge-success" id="profileStatus">Active</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <span class="stat-value" id="loginCount">0</span>
                                    <span class="stat-label">Total Logins</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="lastLoginTime">Never</span>
                                    <span class="stat-label">Last Login</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="accountAge">0 days</span>
                                    <span class="stat-label">Account Age</span>
                                </div>
                            </div>
                        </div>

                        <!-- Personal Information Section -->
                        <div class="profile-section">
                            <h4><i class="fas fa-user"></i> Personal Information</h4>
                            <div class="profile-field">
                                <label>Full Name</label>
                                <span id="profileFullName">Loading...</span>
                            </div>
                            <div class="profile-field">
                                <label>Email Address</label>
                                <span id="profileEmailAddress">Loading...</span>
                            </div>
                            <div class="profile-field">
                                <label>Phone Number</label>
                                <span id="profilePhone">Not provided</span>
                            </div>
                            <div class="profile-field">
                                <label>Admin Role</label>
                                <span id="profileUserRole">Super Admin</span>
                            </div>
                            <div class="profile-field">
                                <label>Account Created</label>
                                <span id="profileCreatedDate">Loading...</span>
                            </div>
                            <div class="profile-field">
                                <label>Account Status</label>
                                <span id="profileAccountStatus">Active</span>
                            </div>
                        </div>

                        <!-- Account Statistics Section -->
                        <div class="profile-section">
                            <h4><i class="fas fa-chart-bar"></i> Account Statistics</h4>
                            <div class="profile-field">
                                <label>Profile Completeness</label>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="profileCompletenessBar" style="width: 0%"></div>
                                    </div>
                                    <span id="profileCompletenessText">0%</span>
                                </div>
                            </div>
                            <div class="profile-field">
                                <label>Security Score</label>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill security-score" id="securityScoreBar" style="width: 0%"></div>
                                    </div>
                                    <span id="securityScoreText">0%</span>
                                </div>
                            </div>
                            <div class="profile-field">
                                <label>Last Profile Update</label>
                                <span id="lastProfileUpdate">Never</span>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="profile-right-column">
                        <!-- Quick Actions Card -->
                        <div class="profile-section">
                            <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
                            <div class="quick-actions-grid">
                                <button class="quick-action-btn btn btn-outline-primary" id="changePasswordBtn">
                                    <i class="fas fa-lock"></i>
                                    <span>Change Password</span>
                                </button>
                                <button class="quick-action-btn btn btn-outline-secondary" id="toggle2FABtn">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Enable 2FA</span>
                                </button>
                                <button class="quick-action-btn btn btn-outline-info" id="viewSessionsBtn">
                                    <i class="fas fa-desktop"></i>
                                    <span>View Sessions</span>
                                </button>
                                <button class="quick-action-btn btn btn-outline-warning" id="downloadDataBtn">
                                    <i class="fas fa-download"></i>
                                    <span>Export Data</span>
                                </button>
                                <button class="quick-action-btn btn btn-outline-success" id="viewNotificationsBtn">
                                    <i class="fas fa-bell"></i>
                                    <span>Notifications</span>
                                </button>
                                <button class="quick-action-btn btn btn-outline-danger" id="viewAuditLogBtn">
                                    <i class="fas fa-clipboard-list"></i>
                                    <span>Audit Log</span>
                                </button>
                            </div>
                        </div>
                        <!-- Security & Authentication Section -->
                        <div class="profile-section">
                            <h4><i class="fas fa-shield-alt"></i> Security & Authentication</h4>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Two-Factor Authentication</label>
                                    <p>Add an extra layer of security to your admin account</p>
                                </div>
                                <div class="setting-action">
                                    <button class="btn btn-outline-primary" id="manage2FABtn">
                                        <span id="twoFactorStatus">Enable 2FA</span>
                                    </button>
                                </div>
                            </div>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Password Security</label>
                                    <p>Last changed: <span id="passwordLastChanged">Never</span></p>
                                </div>
                                <div class="setting-action">
                                    <button class="btn btn-outline-warning" id="changePasswordActionBtn">Change Password</button>
                                </div>
                            </div>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Active Login Sessions</label>
                                    <p>Manage your active login sessions across devices</p>
                                </div>
                                <div class="setting-action">
                                    <button class="btn btn-outline-info" id="manageSessionsBtn">View Sessions</button>
                                </div>
                            </div>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Account Permissions</label>
                                    <p>Your current admin privileges and access levels</p>
                                </div>
                                <div class="setting-action">
                                    <button class="btn btn-outline-secondary" id="viewPermissionsBtn">View Permissions</button>
                                </div>
                            </div>
                        </div>

                        <!-- System Information Section -->
                        <div class="profile-section">
                            <h4><i class="fas fa-info-circle"></i> System Information</h4>
                            <div class="profile-field">
                                <label>Last Login IP</label>
                                <span id="lastLoginIP">Unknown</span>
                            </div>
                            <div class="profile-field">
                                <label>Last Login Device</label>
                                <span id="lastLoginDevice">Unknown</span>
                            </div>
                            <div class="profile-field">
                                <label>Current Session</label>
                                <span id="currentSessionInfo">Active</span>
                            </div>
                            <div class="profile-field">
                                <label>Browser Info</label>
                                <span id="browserInfo">Loading...</span>
                            </div>
                            <div class="profile-field">
                                <label>Session Start Time</label>
                                <span id="sessionStartTime">Loading...</span>
                            </div>
                            <div class="profile-field">
                                <label>Platform</label>
                                <span id="platformInfo">Loading...</span>
                            </div>
                        </div>

                        <!-- Enhanced Activity Log Section -->
                        <div class="profile-section">
                            <h4><i class="fas fa-history"></i> Recent Activity</h4>
                            <div class="activity-log" id="activityLog">
                                <div class="activity-item">
                                    <div class="activity-icon">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                    <div class="activity-details">
                                        <span class="activity-action">Loading activity...</span>
                                        <span class="activity-time">Please wait</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-outline-primary btn-sm mt-3" id="viewFullActivityBtn">
                                <i class="fas fa-external-link-alt"></i> View Full Activity Log
                            </button>
                        </div>

                        <!-- Preferences & Settings Section -->
                        <div class="profile-section">
                            <h4><i class="fas fa-cog"></i> Preferences & Settings</h4>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Email Notifications</label>
                                    <p>Receive important updates via email</p>
                                </div>
                                <div class="setting-action">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>SMS Notifications</label>
                                    <p>Receive security alerts via SMS</p>
                                </div>
                                <div class="setting-action">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="smsNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Auto Logout</label>
                                    <p>Automatically logout after inactivity</p>
                                </div>
                                <div class="setting-action">
                                    <select id="autoLogoutTime" class="form-select">
                                        <option value="30">30 minutes</option>
                                        <option value="60" selected>1 hour</option>
                                        <option value="120">2 hours</option>
                                        <option value="240">4 hours</option>
                                        <option value="0">Never</option>
                                    </select>
                                </div>
                            </div>
                            <div class="security-setting">
                                <div class="setting-info">
                                    <label>Theme Preference</label>
                                    <p>Choose your preferred theme</p>
                                </div>
                                <div class="setting-action">
                                    <select id="themePreference" class="form-select">
                                        <option value="light" selected>Light</option>
                                        <option value="dark">Dark</option>
                                        <option value="auto">Auto</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Profile Edit Modal -->
            <div id="profileEditModal" class="profile-edit-modal">
                <div class="profile-edit-modal-content">
                    <div class="profile-edit-modal-header">
                        <h3><i class="fas fa-user-edit"></i> Edit Profile</h3>
                        <button class="profile-edit-modal-close" id="closeProfileEditModal">&times;</button>
                    </div>
                    <form id="profileEditForm">
                        <div class="edit-form-group">
                            <label for="editFullName">Full Name</label>
                            <input type="text" id="editFullName" name="name" required>
                        </div>
                        <div class="edit-form-group">
                            <label for="editPhone">Phone Number</label>
                            <input type="tel" id="editPhone" name="phone" placeholder="Optional">
                        </div>
                        <div class="edit-form-group">
                            <label for="editEmail">Email Address</label>
                            <input type="email" id="editEmail" name="email" readonly>
                            <small style="color: #64748b; margin-top: 4px; display: block;">Email cannot be changed for security reasons</small>
                        </div>
                        <div class="edit-form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelProfileEdit">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Enhanced Password Change Modal -->
            <div id="passwordChangeModal" class="password-change-modal">
                <div class="password-change-modal-content">
                    <div class="profile-edit-modal-header">
                        <h3><i class="fas fa-lock"></i> Change Password</h3>
                        <button class="profile-edit-modal-close" id="closePasswordChangeModal">&times;</button>
                    </div>
                    <form id="passwordChangeForm">
                        <div class="edit-form-group">
                            <label for="currentPassword">Current Password</label>
                            <div style="position: relative;">
                                <input type="password" id="currentPassword" name="currentPassword" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleCurrentPassword" 
                                        style="position: absolute; right: 8px; top: 8px; padding: 4px 8px;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="edit-form-group">
                            <label for="newPassword">New Password</label>
                            <div style="position: relative;">
                                <input type="password" id="newPassword" name="newPassword" required minlength="6">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleNewPassword"
                                        style="position: absolute; right: 8px; top: 8px; padding: 4px 8px;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small style="color: #64748b; margin-top: 4px; display: block;">Minimum 6 characters required</small>
                        </div>
                        <div class="edit-form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <div style="position: relative;">
                                <input type="password" id="confirmPassword" name="confirmPassword" required>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleConfirmPassword"
                                        style="position: absolute; right: 8px; top: 8px; padding: 4px 8px;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="edit-form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelPasswordChange">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-shield-alt"></i> Change Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Notification Container -->
    <div id="notification-container" style="
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
    "></div>

    <!-- Support Ticket Modal -->
    <div id="supportTicketModal" class="support-ticket-modal" style="display: none;">
        <div class="support-ticket-modal-overlay"></div>
        <div class="support-ticket-modal-content">
            <div class="support-ticket-modal-header">
                <h3>Support Ticket Details</h3>
                <button class="support-ticket-modal-close" id="closeSupportTicketModal">&times;</button>
            </div>
            <div class="support-ticket-modal-body">
                <div class="ticket-info-section">
                    <div class="ticket-meta">
                        <div class="ticket-id">Ticket #<span id="ticketId"></span></div>
                        <div class="ticket-status">
                            <span class="status-badge" id="ticketStatus"></span>
                        </div>
                        <div class="ticket-priority">
                            <span class="priority-badge" id="ticketPriority"></span>
                        </div>
                    </div>
                    <div class="ticket-details">
                        <div class="detail-row">
                            <span class="detail-label">From:</span>
                            <span class="detail-value" id="ticketFrom"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Category:</span>
                            <span class="detail-value" id="ticketCategory"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Subject:</span>
                            <span class="detail-value" id="ticketSubject"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Created:</span>
                            <span class="detail-value" id="ticketCreated"></span>
                        </div>
                    </div>
                </div>
                
                <div class="ticket-conversation">
                    <div class="conversation-header">
                        <h4>Conversation</h4>
                    </div>
                    <div class="conversation-messages" id="conversationMessages">
                        <!-- Messages will be dynamically loaded -->
                    </div>
                </div>

                <div class="ticket-reply-section">
                    <div class="reply-header">
                        <h4>Reply to Ticket</h4>
                        <div class="reply-actions">
                            <select id="ticketStatusUpdate" class="status-select">
                                <option value="open">Open</option>
                                <option value="in-progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="closed">Closed</option>
                            </select>
                            <select id="ticketPriorityUpdate" class="priority-select">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <div class="reply-form">
                        <textarea id="replyMessage" placeholder="Type your reply here..." rows="4"></textarea>
                        <div class="reply-options">
                            <div class="reply-channels">
                                <label class="channel-option">
                                    <input type="checkbox" id="replyViaEmail" checked>
                                    <i class="fas fa-envelope"></i>
                                    Email
                                </label>
                                <label class="channel-option">
                                    <input type="checkbox" id="replyViaNotification" checked>
                                    <i class="fas fa-bell"></i>
                                    In-App Notification
                                </label>
                                <label class="channel-option">
                                    <input type="checkbox" id="replyViaWhatsApp">
                                    <i class="fab fa-whatsapp"></i>
                                    WhatsApp
                                </label>
                            </div>
                            <div class="reply-buttons">
                                <button class="btn btn-secondary" id="saveReplyDraft">Save Draft</button>
                                <button class="btn btn-primary" id="sendReply">Send Reply</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Reply Modal -->
    <div id="quickReplyModal" class="quick-reply-modal" style="display: none;">
        <div class="quick-reply-modal-overlay"></div>
        <div class="quick-reply-modal-content">
            <div class="quick-reply-modal-header">
                <h3>Quick Reply</h3>
                <button class="quick-reply-modal-close" id="closeQuickReplyModal">&times;</button>
            </div>
            <div class="quick-reply-modal-body">
                <div class="quick-reply-templates">
                    <h4>Select Template:</h4>
                    <div class="template-buttons">
                        <button class="template-btn" data-template="acknowledge">Acknowledge Receipt</button>
                        <button class="template-btn" data-template="investigating">Investigating Issue</button>
                        <button class="template-btn" data-template="resolved">Issue Resolved</button>
                        <button class="template-btn" data-template="more-info">Need More Info</button>
                        <button class="template-btn" data-template="escalate">Escalate to Team</button>
                    </div>
                </div>
                <div class="quick-reply-channels">
                    <h4>Send Reply Via:</h4>
                    <div class="channel-options">
                        <label class="channel-option" data-channel="email">
                            <input type="checkbox" id="quickReplyViaEmail" checked>
                            <span class="channel-icon">
                                <i class="fas fa-envelope"></i>
                            </span>
                            <span class="channel-label">Email</span>
                        </label>
                        <label class="channel-option" data-channel="notification">
                            <input type="checkbox" id="quickReplyViaNotification" checked>
                            <span class="channel-icon">
                                <i class="fas fa-bell"></i>
                            </span>
                            <span class="channel-label">Notification</span>
                        </label>
                        <label class="channel-option" data-channel="whatsapp">
                            <input type="checkbox" id="quickReplyViaWhatsApp">
                            <span class="channel-icon">
                                <i class="fab fa-whatsapp"></i>
                            </span>
                            <span class="channel-label">WhatsApp</span>
                        </label>
                    </div>
                </div>
                <div class="quick-reply-form">
                    <textarea id="quickReplyMessage" placeholder="Type your quick reply..." rows="3"></textarea>
                    <div class="quick-reply-actions">
                        <button class="btn btn-primary" id="sendQuickReply">Send Quick Reply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="grievanceSuccessModal" class="quick-reply-modal" style="display: none;">
  <div class="quick-reply-modal-overlay"></div>
  <div class="quick-reply-modal-content" style="max-width: 420px;">
    <div class="quick-reply-modal-header" style="background: #27ae60;">
      <h3 style="color:#fff;"><i class="fas fa-check-circle"></i> Quick Reply Sent</h3>
      <button class="quick-reply-modal-close" id="closeGrievanceSuccessModal" style="color:#fff;">&times;</button>
    </div>
    <div class="quick-reply-modal-body" id="grievanceSuccessBody">
      <!-- Details will be injected here -->
    </div>
  </div>
</div>

<!-- Session Management Modal -->
<div id="sessionsModal" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3><i class="fas fa-desktop"></i> Active Sessions</h3>
            <button class="modal-close" id="closeSessionsModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="sessions-stats" style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div class="stat-card" style="flex: 1; background: #f8fafc; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #1976d2;" id="totalSessionsCount">0</div>
                    <div style="color: #64748b; font-size: 14px;">Total Sessions</div>
                </div>
                <div class="stat-card" style="flex: 1; background: #f8fafc; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #28a745;" id="currentSessionIndicator">1</div>
                    <div style="color: #64748b; font-size: 14px;">Current Session</div>
                </div>
                <div class="stat-card" style="flex: 1; background: #f8fafc; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #dc3545;" id="otherSessionsCount">0</div>
                    <div style="color: #64748b; font-size: 14px;">Other Sessions</div>
                </div>
            </div>
            
            <div class="sessions-list" id="sessionsListContainer">
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <div>Loading sessions...</div>
                </div>
            </div>
            
            <div class="sessions-actions" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn btn-secondary" onclick="refreshSessions()">
                    <i class="fas fa-sync-alt"></i> Refresh Sessions
                </button>
                <button class="btn btn-danger" onclick="terminateAllOtherSessions()" id="terminateAllBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Terminate All Other Sessions
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Notifications Modal -->
<div id="notificationsModal" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <button class="modal-close" id="closeNotificationsModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="notifications-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div class="notifications-stats">
                    <span style="color: #64748b;">Total: <span id="totalNotificationsCount">0</span></span>
                    <span style="color: #dc3545; margin-left: 15px;">Unread: <span id="unreadNotificationsCount">0</span></span>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-outline-primary btn-sm" onclick="markAllNotificationsRead()">
                        <i class="fas fa-check-double"></i> Mark All Read
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="refreshNotifications()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="notifications-filters" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="filter-btn active" data-filter="all" onclick="filterNotifications('all')">All</button>
                <button class="filter-btn" data-filter="unread" onclick="filterNotifications('unread')">Unread</button>
                <button class="filter-btn" data-filter="gym" onclick="filterNotifications('gym')">Gyms</button>
                <button class="filter-btn" data-filter="payment" onclick="filterNotifications('payment')">Payments</button>
                <button class="filter-btn" data-filter="system" onclick="filterNotifications('system')">System</button>
            </div>
            
            <div class="notifications-list" id="notificationsListContainer">
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <div>Loading notifications...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Activity/Audit Log Modal -->
<div id="activityModal" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
            <h3><i class="fas fa-history"></i> <span id="activityModalTitle">Activity Log</span></h3>
            <button class="modal-close" id="closeActivityModal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="activity-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div class="activity-stats">
                    <span style="color: #64748b;">Total Events: <span id="totalActivityCount">0</span></span>
                    <span style="color: #1976d2; margin-left: 15px;">Time Range: <span id="activityTimeRange">24 Hours</span></span>
                </div>
                <div class="activity-actions">
                    <select id="activityTimeFilter" onchange="changeActivityTimeRange()" style="margin-right: 10px; padding: 5px; border: 1px solid #e2e8f0; border-radius: 4px;">
                        <option value="24">Last 24 Hours</option>
                        <option value="168">Last 7 Days</option>
                        <option value="720">Last 30 Days</option>
                        <option value="2160">Last 90 Days</option>
                    </select>
                    <button class="btn btn-outline-secondary btn-sm" onclick="refreshActivityLog()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="activity-logs" id="activityLogsContainer">
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <div>Loading activity logs...</div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>